# ============================================
# Aurora Hotel Plaza - Apache Configuration
# Performance + URL Rewrites + Security
# ============================================

# Enable Rewrite Engine
RewriteEngine On

# ── Pretty URL Rewrites ──────────────────────
# gallery/7 → gallery.php?page=7
RewriteRule ^gallery/(\d+)$ gallery.php?page=$1 [L,QSA]

# ── Browser Caching ──────────────────────────
<IfModule mod_expires.c>
ExpiresActive On

# Images: 1 month
ExpiresByType image/jpeg "access plus 1 month"
ExpiresByType image/png "access plus 1 month"
ExpiresByType image/gif "access plus 1 month"
ExpiresByType image/webp "access plus 1 month"
ExpiresByType image/svg+xml "access plus 1 month"
ExpiresByType image/x-icon "access plus 1 year"

# CSS & JS: 1 week (versioned via query string)
ExpiresByType text/css "access plus 1 week"
ExpiresByType application/javascript "access plus 1 week"
ExpiresByType text/javascript "access plus 1 week"

# Fonts: 1 month
ExpiresByType font/woff2 "access plus 1 month"
ExpiresByType font/woff "access plus 1 month"
ExpiresByType application/font-woff2 "access plus 1 month"
ExpiresByType application/font-woff "access plus 1 month"
ExpiresByType font/ttf "access plus 1 month"
ExpiresByType application/font-sfnt "access plus 1 month"

# HTML: no cache (dynamic pages)
ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ── Gzip Compression ────────────────────────
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE text/javascript
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE image/svg+xml
AddOutputFilterByType DEFLATE font/woff
AddOutputFilterByType DEFLATE font/ttf
AddOutputFilterByType DEFLATE application/font-woff
</IfModule>

# ── Cache Control Headers ────────────────────
<IfModule mod_headers.c>
# Static assets - long cache with immutable
<FilesMatch "\.(css|js|woff2|woff|ttf|eot)$">
Header set Cache-Control "public, max-age=604800, immutable"
</FilesMatch>

# Images - 30 days
<FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
Header set Cache-Control "public, max-age=2592000"
</FilesMatch>

# HTML/PHP - no cache
<FilesMatch "\.(html|php)$">
Header set Cache-Control "no-cache, must-revalidate"
</FilesMatch>

# Keep-Alive for connection reuse
Header set Connection keep-alive

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ── ETag optimization ────────────────────────
FileETag MTime Size

# ── Prevent directory listing ────────────────
Options -Indexes

# ── Block access to sensitive files ──────────
<FilesMatch "^(\.env|\.git|composer\.(json|lock)|package\.json)$">
Require all denied
</FilesMatch>

# Block access to config directory
<IfModule mod_rewrite.c>
RewriteRule ^config/ - [F,L]
</IfModule>
